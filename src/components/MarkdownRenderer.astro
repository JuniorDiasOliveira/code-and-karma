---
import CodeBlock from './CodeBlock';

interface Props {
  content: string;
}

const { content } = Astro.props;

// Split content by code blocks
const parts = content.split(/(```[\s\S]*?```)/g);
---

<div class="markdown-content">
  {parts.map((part) => {
    // Check if this is a code block
    if (part.startsWith('```') && part.endsWith('```')) {
      const lines = part.split('\n');
      const language = lines[0].replace('```', '').trim() || 'text';
      const code = lines.slice(1, -1).join('\n');
      
      return <CodeBlock language={language} client:load>{code}</CodeBlock>;
    }
    
    // Process regular markdown
    return (
      <div class="prose-content">
        {part.split('\n').map((line) => {
          // Headers
          if (line.startsWith('# ')) {
            return (
              <h1 class="text-4xl font-bold mt-8 mb-4 neon-gradient-text neon-glow-green">
                {line.substring(2)}
              </h1>
            );
          }
          if (line.startsWith('## ')) {
            return (
              <h2 class="text-3xl font-bold mt-6 mb-3 neon-glow-cyan text-secondary">
                {line.substring(3)}
              </h2>
            );
          }
          if (line.startsWith('### ')) {
            return (
              <h3 class="text-2xl font-bold mt-4 mb-2 text-primary">
                {line.substring(4)}
              </h3>
            );
          }
          
          // Empty lines
          if (line.trim() === '') {
            return <br />;
          }
          
          // Process inline code
          const processedLine = line.split(/(`[^`]+`)/g).map((segment, i) => {
            if (segment.startsWith('`') && segment.endsWith('`')) {
              const codeText = segment.slice(1, -1);
              return (
                <code 
                  key={i}
                  class="px-2 py-1 bg-muted/50 border border-primary/30 rounded text-primary font-mono text-sm"
                >
                  {codeText}
                </code>
              );
            }
            return segment;
          });
          
          // Regular paragraphs
          return (
            <p class="text-foreground leading-relaxed mb-4">
              {processedLine}
            </p>
          );
        })}
      </div>
    );
  })}
</div>
